# æƒ å¤šç¾å•†åŸ - Flutter ç”µå•†åº”ç”¨

## ğŸ“± é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Flutter å¼€å‘çš„ç”µå•†ç±»ç§»åŠ¨åº”ç”¨ï¼ŒåŒ…å«é¦–é¡µã€åˆ†ç±»ã€è´­ç‰©è½¦ã€ä¸ªäººä¸­å¿ƒç­‰æ ¸å¿ƒæ¨¡å—ã€‚å®ç°äº†å•†å“å±•ç¤ºã€ç”¨æˆ·ç™»å½•ã€ä¸ªäººä¿¡æ¯ç®¡ç†ç­‰åŸºç¡€åŠŸèƒ½ã€‚é¡¹ç›®é‡‡ç”¨ **MVVM æ¶æ„** æ€æƒ³ï¼Œç»“åˆ **GetX** è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œ**Dio** å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œå®ç°äº†ä¸€å¥—ç»“æ„æ¸…æ™°ã€æ˜“äºç»´æŠ¤çš„ç§»åŠ¨ç”µå•†è§£å†³æ–¹æ¡ˆã€‚

------

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

- **é¦–é¡µå•†å“å±•ç¤º**ï¼ˆè½®æ’­å›¾ã€åˆ†ç±»å¯¼èˆªã€ç‰¹æƒ æ¨èã€çˆ†æ¬¾å•†å“ï¼‰
- **ç”¨æˆ·ç™»å½• / é€€å‡ºåŠŸèƒ½**
- **ä¸ªäººä¸­å¿ƒä¿¡æ¯å±•ç¤º**
- **å•†å“æ¨èåˆ—è¡¨**ï¼ˆæ”¯æŒä¸‹æ‹‰åˆ·æ–°ã€ä¸Šæ‹‰åŠ è½½ï¼‰
- **åº•éƒ¨å¯¼èˆªåˆ‡æ¢**

------

## ğŸ›  æŠ€æœ¯æ ˆ

- **æ¡†æ¶**ï¼šFlutter
- **çŠ¶æ€ç®¡ç†**ï¼šGetX
- **ç½‘ç»œè¯·æ±‚**ï¼šDio
- **æœ¬åœ°å­˜å‚¨**ï¼šSharedPreferencesï¼ˆç”¨äº Token ç®¡ç†ï¼‰
- **è·¯ç”±ç®¡ç†**ï¼šFlutter åŸç”Ÿè·¯ç”±

------

## ğŸš€ è¿è¡Œæ–¹æ³•

### ç¯å¢ƒè¦æ±‚

- Flutter 3.0+
- Dart 2.17+
- Android Studio / Xcodeï¼ˆå¯¹åº”å¹³å°å¼€å‘å·¥å…·ï¼‰
- æ¨¡æ‹Ÿå™¨æˆ–çœŸå®è®¾å¤‡

### æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**

   bash

   ```
   git clone https://github.com/bililateral/hm_shop.git
   cd hm_shop
   ```

   

2. **å®‰è£…ä¾èµ–**

   bash

   ```
   flutter pub get
   ```

   

3. **é…ç½®ç¯å¢ƒ**ï¼ˆå¯é€‰ï¼‰
   è‹¥ API æ¥å£åœ°å€éœ€è¦ä¿®æ”¹ï¼Œå¯ç¼–è¾‘ `lib/constants/index.dart` æ–‡ä»¶ä¸­çš„ `BASE_URL`ï¼š

   dart

   ```
   class GlobalConstants {
     static const String BASE_URL = "ä½ çš„APIåŸºç¡€åœ°å€"; // ä¿®æ”¹ä¸ºå®é™…å¯ç”¨çš„APIåœ°å€
     // ...å…¶ä»–é…ç½®
   }
   ```

   

4. **è¿è¡Œé¡¹ç›®**

   - è¿æ¥è®¾å¤‡æˆ–å¯åŠ¨æ¨¡æ‹Ÿå™¨

   - æ‰§è¡Œè¿è¡Œå‘½ä»¤ï¼š

     bash

     ```
     flutter run
     ```

     

------

## ğŸ“„ å…³é”®é¡µé¢å®ç°è¯´æ˜

### 1. ä¸»é¡µé¢ï¼ˆMainPageï¼‰

- **è·¯å¾„**ï¼š`lib/pages/Main/index.dart`

- **åŠŸèƒ½**ï¼šä½œä¸ºåº”ç”¨å…¥å£ï¼Œç®¡ç†åº•éƒ¨å¯¼èˆªå’Œé¡µé¢åˆ‡æ¢

- **æ ¸å¿ƒå®ç°**ï¼š

  - ä½¿ç”¨ `IndexedStack` ç®¡ç†é¦–é¡µã€åˆ†ç±»ã€è´­ç‰©è½¦ã€æˆ‘çš„å››ä¸ªé¡µé¢ï¼Œä¿æŒé¡µé¢çŠ¶æ€
  - åº•éƒ¨å¯¼èˆªé€šè¿‡ `BottomNavigationBar` å®ç°ï¼Œé€šè¿‡ `_currentIndex` æ§åˆ¶é€‰ä¸­çŠ¶æ€
  - åˆå§‹åŒ–æ—¶é€šè¿‡ `tokenManager` æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼Œè‡ªåŠ¨è·å–ç”¨æˆ·ä¿¡æ¯

  dart

  ```
  // é¡µé¢åˆ‡æ¢æ ¸å¿ƒä»£ç 
  body: SafeArea(
    child: IndexedStack(index: _currentIndex, children: _getChildren()),
  ),
  bottomNavigationBar: BottomNavigationBar(
    onTap: (value) {
      _currentIndex = value;
      setState(() {});
    },
    // ...å…¶ä»–é…ç½®
  ),
  ```

  

### 2. é¦–é¡µï¼ˆHomeViewï¼‰

- **è·¯å¾„**ï¼š`lib/pages/Home/index.dart`

- **åŠŸèƒ½**ï¼šå±•ç¤ºå•†å“è½®æ’­å›¾ã€åˆ†ç±»å¯¼èˆªã€ç‰¹æƒ æ¨èç­‰å†…å®¹

- **æ ¸å¿ƒå®ç°**ï¼š

  - ä½¿ç”¨ `CustomScrollView` å®ç°æ»šåŠ¨å¸ƒå±€ï¼ŒåŒ…å«å¤šä¸ª Sliver ç»„ä»¶
  - ä¸‹æ‹‰åˆ·æ–°é€šè¿‡ `RefreshIndicator` å®ç°ï¼Œé‡ç½®æ•°æ®å¹¶é‡æ–°è¯·æ±‚
  - ä¸Šæ‹‰åŠ è½½é€šè¿‡ `ScrollController` ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œè§¦å‘åˆ†é¡µè¯·æ±‚
  - æ•°æ®æ¸²æŸ“ï¼šè½®æ’­å›¾ï¼ˆHmSliderï¼‰ã€åˆ†ç±»å¯¼èˆªï¼ˆHmCategoryï¼‰ã€æ¨èåˆ—è¡¨ï¼ˆHmMoreListï¼‰

  dart

  ```
  // ä¸‹æ‹‰åˆ·æ–°æ ¸å¿ƒä»£ç 
  return RefreshIndicator(
    onRefresh: () async {
      _page = 1;
      _isLoading = false;
      _hasMore = true;
      await _getBannerList();
      // ...é‡æ–°åŠ è½½å…¶ä»–æ•°æ®
    },
    child: CustomScrollView(
      controller: _controller,
      slivers: _getScrollChildren(),
    ),
  );
  ```

  

### 3. ç™»å½•é¡µï¼ˆLoginPageï¼‰

- **è·¯å¾„**ï¼š`lib/pages/Login/index.dart`

- **åŠŸèƒ½**ï¼šç”¨æˆ·è´¦å·å¯†ç ç™»å½•

- **æ ¸å¿ƒå®ç°**ï¼š

  - ä½¿ç”¨ `Form` ç»„ä»¶è¿›è¡Œè¡¨å•éªŒè¯ï¼Œæ ¡éªŒæ‰‹æœºå·å’Œå¯†ç æ ¼å¼
  - ç™»å½•é€»è¾‘ï¼šé€šè¿‡ `loginAPI` æäº¤è´¦å·å¯†ç ï¼ŒæˆåŠŸåä¿å­˜ Token å¹¶æ›´æ–°ç”¨æˆ·ä¿¡æ¯
  - ä½¿ç”¨ `LoadingDialog` å±•ç¤ºç™»å½•åŠ è½½çŠ¶æ€ï¼Œé€šè¿‡ `ScaffoldMessenger` æ˜¾ç¤ºæç¤ºä¿¡æ¯
  - å‹¾é€‰ç”¨æˆ·åè®®éªŒè¯ï¼Œæœªå‹¾é€‰æ—¶é˜»æ­¢ç™»å½•

  dart

  ```
  // ç™»å½•æ ¸å¿ƒä»£ç 
  void _login() async {
    try {
      LoadingDialog.show(context, message: "æ­£åœ¨ç™»å½•,è¯·ç¨å€™");
      final res = await loginAPI({
        "account": _phoneController.text,
        "password": _codeController.text,
      });
      _userController.updateUserInfo(res); // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
      tokenManager.setToken(res.token); // ä¿å­˜Token
      LoadingDialog.hide(context);
      // ç™»å½•æˆåŠŸæç¤ºå¹¶è¿”å›
    } catch (e) {
      // é”™è¯¯å¤„ç†
    }
  }
  ```

  

### 4. ä¸ªäººä¸­å¿ƒï¼ˆMineViewï¼‰

- **è·¯å¾„**ï¼š`lib/pages/My/index.dart`

- **åŠŸèƒ½**ï¼šå±•ç¤ºç”¨æˆ·ä¿¡æ¯ã€æä¾›é€€å‡ºç™»å½•ç­‰åŠŸèƒ½

- **æ ¸å¿ƒå®ç°**ï¼š

  - ä½¿ç”¨ `Obx` ç›‘å¬ç”¨æˆ·ä¿¡æ¯å˜åŒ–ï¼Œå®ç°å“åº”å¼ UI æ›´æ–°
  - é€€å‡ºç™»å½•ï¼šæ¸…é™¤ Tokenã€é‡ç½®ç”¨æˆ·ä¿¡æ¯ï¼Œé€šè¿‡å¯¹è¯æ¡†ç¡®è®¤æ“ä½œ
  - çŒœä½ å–œæ¬¢åˆ—è¡¨ï¼šæ”¯æŒä¸Šæ‹‰åŠ è½½æ›´å¤šï¼Œé€šè¿‡ `ScrollController` å®ç°åˆ†é¡µ
  - ç”¨æˆ·ä¿¡æ¯å±•ç¤ºï¼šæ ¹æ®ç™»å½•çŠ¶æ€æ˜¾ç¤º â€œç«‹å³ç™»å½•â€ æˆ–ç”¨æˆ·å / å¤´åƒ

  dart

  ```
  // é€€å‡ºç™»å½•æ ¸å¿ƒä»£ç 
  onPressed: () async {
    await tokenManager.removeToken(); // æ¸…é™¤Token
    _userController.updateUserInfo(UserInfo.fromJSON({})); // é‡ç½®ç”¨æˆ·ä¿¡æ¯
    Navigator.pop(context);
    setState(() {});
  },
  ```

  

------

## ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜

text

```
lib/
â”œâ”€â”€ api/            # ç½‘ç»œè¯·æ±‚æ¥å£å°è£…
â”œâ”€â”€ components/     # é€šç”¨ç»„ä»¶
â”œâ”€â”€ constants/      # å¸¸é‡å®šä¹‰ï¼ˆAPIåœ°å€ã€é…ç½®ç­‰ï¼‰
â”œâ”€â”€ pages/          # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ Main/       # ä¸»é¡µé¢ï¼ˆåº•éƒ¨å¯¼èˆªï¼‰
â”‚   â”œâ”€â”€ Home/       # é¦–é¡µ
â”‚   â”œâ”€â”€ Category/   # åˆ†ç±»é¡µ
â”‚   â”œâ”€â”€ Cart/       # è´­ç‰©è½¦
â”‚   â”œâ”€â”€ My/         # ä¸ªäººä¸­å¿ƒ
â”‚   â””â”€â”€ Login/      # ç™»å½•é¡µ
â”œâ”€â”€ routes/         # è·¯ç”±é…ç½®
â”œâ”€â”€ stores/         # çŠ¶æ€ç®¡ç†ï¼ˆTokenã€ç”¨æˆ·ä¿¡æ¯ï¼‰
â”œâ”€â”€ utils/          # å·¥å…·ç±»ï¼ˆDioå°è£…ç­‰ï¼‰
â””â”€â”€ viewmodels/     # æ•°æ®æ¨¡å‹å®šä¹‰
```



------

## âš ï¸ æ³¨æ„äº‹é¡¹

- é¡¹ç›®ä¸­éƒ¨åˆ† API åœ°å€å¯èƒ½æ— æ³•è®¿é—®ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€æ›¿æ¢ä¸ºå¯ç”¨æ¥å£
- å›¾ç‰‡èµ„æºè·¯å¾„åŸºäºé¡¹ç›®å®é™…ç»“æ„ï¼Œè‹¥ä¿®æ”¹èµ„æºä½ç½®éœ€åŒæ­¥æ›´æ–°å¼•ç”¨è·¯å¾„
- çŠ¶æ€ç®¡ç†ä¾èµ– GetXï¼Œéœ€ç¡®ä¿ç›¸å…³ Controller å·²æ­£ç¡®åˆå§‹åŒ–ï¼ˆGet.put/Get.findï¼‰